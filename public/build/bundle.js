var app=function(e){"use strict";const t={moveTo:e=>2===e.length?"moveTo must have 2 parameters":null,lineTo:e=>2===e.length?"lineTo must have 2 parameters":null,bezierCurveTo:e=>6===e.length?"bezierCurveTo must have 6 parameters":null,quadraticCurveTo:e=>4===e.length?"quadraticCurveTo must have 4 parameters":null,arc:e=>5===e.length||6===e.length?"arc must have 5 or 6 parameters":null,arcTo:e=>5===e.length?"arcTo must have 5 parameters":null,ellipse:e=>7===e.length||8===e.length?"ellipse must have 7 or 8 parameters":null,rect:e=>4===e.length?"rect must have 4 parameters":null,closePath:e=>0===e.length?"closePath must have 0 parameters":null},n={moveTo:(e,t)=>({xmin:e,ymin:t,xmax:e,ymax:t}),lineTo:(e,t)=>({xmin:e,ymin:t,xmax:e,ymax:t}),bezierCurveTo:(e,t,n,r,a,o)=>({xmin:Math.min(e,n,a),ymin:Math.min(t,r,o),xmax:Math.max(e,n,a),ymax:Math.max(t,r,o)}),quadraticCurveTo:(e,t,n,r)=>({xmin:Math.min(e,n),ymin:Math.min(t,r),xmax:Math.max(e,n),ymax:Math.max(t,r)}),arc:(e,t,n)=>({xmin:e-n,ymin:t-n,xmax:e+n,ymax:t+n}),arcTo:(e,t,n,r)=>({xmin:Math.min(e,n),ymin:Math.min(t,r),xmax:Math.max(e,n),ymax:Math.max(t,r)}),ellipse:(e,t,n,r)=>({xmin:Math.min(e-n,e-r),ymin:Math.min(t-r,t-r),xmax:Math.max(e+n,e+n),ymax:Math.max(t+r,t+r)}),rect:(e,t,n,r)=>({xmin:e,ymin:t,xmax:e+n,ymax:t+r})};function r(e,t,n){return e*n[0]+t*n[2]+n[4]}function a(e,t,n){return t*n[1]+e*n[3]+n[5]}function o(e){if(e.text)return e;if(!e.length)return null;let t=new Path2D;return e.forEach(e=>{t[e[0]](...e.slice(1))}),t}var i={pathsToShapes:function(e){let t={};for(let n in e){let r=o(e[n]);t[n]=r}return t},pathToBox:function(e){if(!e.length)return null;let t=[],r=[],a=[],o=[];return e.forEach(e=>{if(e[0]in n){let i=n[e[0]](...e.slice(1));t.push(i.xmin),r.push(i.ymin),a.push(i.xmax),o.push(i.ymax)}}),{min:{x:Math.min(...t),y:Math.min(...r)},max:{x:Math.max(...a),y:Math.max(...o)}}},transformBox:function({min:e,max:t},n){let o=Math.min(r(e.x,e.y,n),r(e.x,t.y,n),r(t.x,e.y,n),r(t.x,t.y,n)),i=Math.max(r(e.x,e.y,n),r(e.x,t.y,n),r(t.x,e.y,n),r(t.x,t.y,n));return{min:{x:o,y:Math.min(a(e.x,e.y,n),a(e.x,t.y,n),a(t.x,e.y,n),a(t.x,t.y,n))},max:{x:i,y:Math.max(a(e.x,e.y,n),a(e.x,t.y,n),a(t.x,e.y,n),a(t.x,t.y,n))}}},pathToCanvas:o,pathValidate:function(e){if(!e.length)return"Paths must have at least 1 instruction";let n=[];return e.forEach(e=>{let r=t[e[0]](e.slice(1));r&&n.push(r)}),n},applyTransform:function(e,t){return[e[0]*t[0]+e[2]*t[1],e[1]*t[0]+e[3]*t[1],e[0]*t[2]+e[2]*t[3],e[1]*t[2]+e[3]*t[3],e[0]*t[4]+e[2]*t[5]+e[4],e[1]*t[4]+e[3]*t[5]+e[5]]}};var s={tracer:function(e=[]){const t={x:[],y:[],checks:{},order:{}};let n=0;function r(e,n){return t.order[e]<t.order[n]?1:t.order[e]>t.order[n]?-1:0}function a(e,t){return e.index<t.index?-1:e.index>t.index?1:0}return{insert:(e,r,o,i)=>{t.checks[o]=i,t.order[o]=n,n+=1,t.x.push({index:Math.floor(e.x),value:o}),t.x.push({index:Math.floor(r.x),value:o}),t.x.sort(a),t.y.push({index:Math.floor(e.y),value:o}),t.y.push({index:Math.floor(r.y),value:o}),t.y.sort(a)},intersectPoint:e=>{let n=new Set,a=Math.floor(e.x),o=Math.floor(e.y);for(let e in t.x){let r=t.x[e];if(!(r.index<=a))break;n.has(r.value)?n.delete(r.value):n.add(r.value)}let i=[...n];n=new Set;for(let e in t.y){let r=t.y[e];if(!(r.index<=o))break;n.has(r.value)?n.delete(r.value):n.add(r.value)}return[...i].filter(e=>n.has(e)).filter(n=>t.checks[n](e.x,e.y)).sort(r)},intersectBox:({min:e,max:n})=>{let a=new Set,o=Math.floor(e.x),i=Math.floor(n.x),s=Math.floor(e.y),l=Math.floor(n.y);for(let e in t.x){let n=t.x[e];if(n.index<=o)a.has(n.value)?a.delete(n.value):a.add(n.value);else{if(!(n.index<=i))break;a.add(n.value)}}let u=[...a];a=new Set;for(let e in t.y){let n=t.y[e];if(n.index<=s)a.has(n.value)?a.delete(n.value):a.add(n.value);else{if(!(n.index<=l))break;a.add(n.value)}}return[...u].filter(e=>a.has(e)).sort(r)}}},boxesIntersect:function(e,t){return!(e.max.x<t.min.x)&&(!(t.max.x<e.min.x)&&(!(e.max.y<t.min.y)&&!(t.max.y<t.max.y)))},boxBox:function(e){return{max:{x:Math.max(...e.map(e=>e.max.x)),y:Math.max(...e.map(e=>e.max.y))},min:{x:Math.min(...e.map(e=>e.min.x)),y:Math.min(...e.map(e=>e.min.y))}}},generateHitChecker:function(e,t,n){return(r,a)=>{e.save(),e.setTransform(...n);const o=e.isPointInPath(t,r,a);return e.restore(),o}}};const l={fillStyle:null,strokeStyle:null,lineWidth:1,lineCap:"butt",lineJoin:"miter",miterLimit:10,lineDash:[],lineDashOffset:0,shadowOffsetX:0,shadowOffsetY:0,shadowBlur:0,shadowColor:"transparent",fill:"nonzero",font:"sans-serif",textAlign:"start",textBaseline:"alphabetic",direction:"inherit"};function u(e){let t={...l,...e};return function(e,n){e.lineWidth=t.lineWidth,e.lineCap=t.lineCap,e.lineJoin=t.lineJoin,e.miterLimit=t.miterLimit,e.setLineDash(t.lineDash),e.lineDashOffset=t.lineDashOffset,e.font=t.font,e.textAlign=t.textAlign,e.textBaseline=t.textBaseline,e.direction=t.direction,e.shadowOffsetX=t.shadowOffsetX,e.shadowOffsetY=t.shadowOffsetY,e.shadowBlur=t.shadowBlur,e.shadowColor=t.shadowColor,e.fillStyle=t.fillStyle,e.strokeStyle=t.strokeStyle,n.text?(t.fillStyle&&e.fillText(n.text,n.x,n.y,n.maxWidth),t.strokeStyle&&e.strokeText(n.text,n.x,n.y,n.maxWidth)):(t.fillStyle&&e.fill(n),t.strokeStyle&&e.stroke(n))}}var m={linearGradient:function(e,t,n,r){let a=e.createLinearGradient(t.x,t.y,n.x,n.y);return r.forEach(({loc:e,color:t})=>a.addColorStop(e,t)),a},radialGradient:function(e,t,n,r){let a=e.createRadialGradient(t.x,t.y,t.radius,n.x,n.y,n.radius);return r.forEach(({loc:e,color:t})=>a.addColorStop(e,t)),a},pattern:function(e,t,n){let r=new Image;return r.src(t),e.createPattern(r,n)},palletteToPainter:u,pallettesToPainters:function(e){let t={};for(let n in e){let r=u(e[n]);t[n]=r}return t}};function c({area:e,extents:t,transform:n}){let r=-t.min.x,a=e.width-t.max.x*n[0],o=-t.min.y,i=e.height-t.max.y*n[3];null!==t.min.x&&n[4]<a&&(n[4]=a),null!==t.max.x&&n[4]>r&&(n[4]=r),null!==t.min.y&&n[5]<i&&(n[5]=i),null!==t.max.y&&n[5]>o&&(n[5]=o)}var h={mouse:{zoom:(e,t,n=1.2)=>{let r=t.transform[0]*n**-Math.sign(e.deltaY);r=r>t.extents.max.zoom?t.extents.max.zoom:r;const a=function({extents:e,area:t}){const n=[e.min.zoom];return null!==e.max.x&&null!==e.min.x&&n.push(t.width/(e.max.x-e.min.x)),null!==e.min.y&&null!==e.max.y&&n.push(t.height/(e.max.y-e.min.y)),Math.max(...n)}(t);r=r<a?a:r,function({transform:e},t,n=null,r=null){n=null===n?e[4]+area.width/(2*e[0]):n,r=null===r?e[5]+area.height/(2*e[3]):r,e[4]=n-t*(n-e[4])/e[0],e[5]=r-t*(r-e[5])/e[3],e[0]=t,e[3]=t}(t,r,e.clientX,e.clientY),c(t),e.preventDefault(),e.stopPropagation()},pan:(e,t)=>{let n=e.clientX,r=e.clientY;return e=>{t.transform[4]=t.transform[4]+e.clientX-n,t.transform[5]=t.transform[5]+e.clientY-r,n=e.clientX,r=e.clientY,c(t)}}}};const f={},d={},x={},p={},y={};function g(e,t){p[e]=(e,n,r)=>{n.visible&&(e.save(),e.transform(...n.transform),t(e,n.details,r),e.restore())}}function v(e,t,n){y[e]={controls:t,init:n}}g("simple",(e,{shape:t,style:n,trace:r},{viewport:a,handles:o,tome:l})=>{const u=e.getTransform(),m=[u.a,u.b,u.c,u.d,u.e,u.f],{box:c,path:h}=l.shape(t),f=i.transformBox(c,m);s.boxesIntersect(a,f)&&(r&&o.insert(f.min,f.max,r,s.generateHitChecker(e,h,m)),l.style(n).painter(e,h))}),g("nested",(e,{subjects:t},n)=>{t.forEach(t=>{const r=n.tome.subject(t);n.tome.renderer(r.renderer)(e,r,n)})}),g("text",(e,{style:t,text:n,x:r,y:a,maxWidth:o},{tome:i})=>{i.style(t).painter(e,{text:n,x:r,y:a,maxWidth:o})}),v(null,{},()=>null),v("default",{mousedown:(e,{geo:t,elem:n})=>{n.set("panning",{mouse:e,geo:t,end:()=>{n.set("default",{geo:t,elem:n})}})},wheel:(e,{geo:t})=>{h.mouse.zoom(e,t.camera)}},e=>e),v("panning",{mouseup:(e,{end:t})=>{t()},mouseout:(e,{end:t})=>{t()},mousemove:(e,{pan:t})=>{t(e)}},({mouse:e,geo:t,end:n})=>({pan:h.mouse.pan(e,t.camera),end:n}));var b={register:{shape:(e,t)=>{f[e]={instructions:t,path:i.pathToCanvas(t),box:i.pathToBox(t)}},style:(e,t)=>{d[e]={styling:t,painter:m.palletteToPainter(t)}},subject:(e,{renderer:t,details:n,visible:r,transform:a})=>{x[e]={renderer:t,details:n,visible:r,transform:a}},renderer:g,mode:v},shape:e=>f[e],style:e=>d[e],subject:e=>x[e],renderer:e=>p[e],mode:e=>y[e],export:()=>JSON.stringify({subjects:x,shapes:f,styles:d}),import:e=>{imports=JSON.parse(e),f={...f,...imports.shapes},d={...d,...imports.styles},x={...x,...imports.subjects}}};function $(e){const t={mode:null,listeners:[]};return{set:(n,r)=>{const a=b.mode(n).init(r);t.listeners.forEach(([t,n])=>e.removeEventListener(t,n));let o=[],i=b.mode(n).controls;for(const t in i)o.push([t,n=>i[t](n,a,e)]);o.forEach(([t,n])=>e.addEventListener(t,n)),t.listeners=o,t.mode=n},element:()=>e,mode:()=>t.mode}}function w(){const e={camera:{transform:[1,0,0,1,0,0],extents:{min:{x:null,y:null,zoom:null},max:{x:null,y:null,zoom:null}},area:{width:800,height:800}},scene:[],tome:b,handles:s.tracer(),render:t=>{t.setTransform(1,0,0,1,0,0),t.clearRect(0,0,e.camera.area.width,e.camera.area.height),t.setTransform(...e.camera.transform);const n=i.transformBox({min:{x:0,y:0},max:{x:e.camera.area.width,y:e.camera.area.height}},e.camera.transform);e.handles=s.tracer(),e.scene.forEach(r=>{const a=b.subject(r),o=b.renderer(a.renderer);o&&o(t,a,{viewport:n,handles:e.handles,tome:b})})}};return e}function M(){}function T(e){return e()}function k(){return Object.create(null)}function C(e){e.forEach(T)}function S(e){return"function"==typeof e}function E(e,t){return e!=e?t==t:e!==t||e&&"object"==typeof e||"function"==typeof e}function B(e,t,n){e.insertBefore(t,n||null)}function P(e){e.parentNode.removeChild(e)}function _(e,t,n){null==n?e.removeAttribute(t):e.getAttribute(t)!==n&&e.setAttribute(t,n)}let z;function O(e){z=e}function j(e){(function(){if(!z)throw new Error("Function called outside component initialization");return z})().$$.on_mount.push(e)}const L=[],A=[],W=[],Y=[],D=Promise.resolve();let X=!1;function J(e){W.push(e)}function q(e){Y.push(e)}let G=!1;const H=new Set;function I(){if(!G){G=!0;do{for(let e=0;e<L.length;e+=1){const t=L[e];O(t),N(t.$$)}for(L.length=0;A.length;)A.pop()();for(let e=0;e<W.length;e+=1){const t=W[e];H.has(t)||(H.add(t),t())}W.length=0}while(L.length);for(;Y.length;)Y.pop()();X=!1,G=!1,H.clear()}}function N(e){if(null!==e.fragment){e.update(),C(e.before_update);const t=e.dirty;e.dirty=[-1],e.fragment&&e.fragment.p(e.ctx,t),e.after_update.forEach(J)}}const R=new Set;let F;function V(e,t){e&&e.i&&(R.delete(e),e.i(t))}function K(e,t,n){const r=e.$$.props[t];void 0!==r&&(e.$$.bound[r]=n,n(e.$$.ctx[r]))}function Q(e,t,n){const{fragment:r,on_mount:a,on_destroy:o,after_update:i}=e.$$;r&&r.m(t,n),J(()=>{const t=a.map(T).filter(S);o?o.push(...t):C(t),e.$$.on_mount=[]}),i.forEach(J)}function U(e,t){const n=e.$$;null!==n.fragment&&(C(n.on_destroy),n.fragment&&n.fragment.d(t),n.on_destroy=n.fragment=null,n.ctx=[])}function Z(e,t){-1===e.$$.dirty[0]&&(L.push(e),X||(X=!0,D.then(I)),e.$$.dirty.fill(0)),e.$$.dirty[t/31|0]|=1<<t%31}function ee(e,t,n,r,a,o,i=[-1]){const s=z;O(e);const l=t.props||{},u=e.$$={fragment:null,ctx:null,props:o,update:M,not_equal:a,bound:k(),on_mount:[],on_destroy:[],before_update:[],after_update:[],context:new Map(s?s.$$.context:[]),callbacks:k(),dirty:i};let m=!1;if(u.ctx=n?n(e,l,(t,n,...r)=>{const o=r.length?r[0]:n;return u.ctx&&a(u.ctx[t],u.ctx[t]=o)&&(u.bound[t]&&u.bound[t](o),m&&Z(e,t)),n}):[],u.update(),m=!0,C(u.before_update),u.fragment=!!r&&r(u.ctx),t.target){if(t.hydrate){const e=function(e){return Array.from(e.childNodes)}(t.target);u.fragment&&u.fragment.l(e),e.forEach(P)}else u.fragment&&u.fragment.c();t.intro&&V(e.$$.fragment),Q(e,t.target,t.anchor),I()}O(s)}"function"==typeof HTMLElement&&(F=class extends HTMLElement{constructor(){super(),this.attachShadow({mode:"open"})}connectedCallback(){for(const e in this.$$.slotted)this.appendChild(this.$$.slotted[e])}attributeChangedCallback(e,t,n){this[e]=n}$destroy(){U(this,1),this.$destroy=M}$on(e,t){const n=this.$$.callbacks[e]||(this.$$.callbacks[e]=[]);return n.push(t),()=>{const e=n.indexOf(t);-1!==e&&n.splice(e,1)}}$set(){}});const te=[];function ne(e){let t,n,r;return{c(){var a;a="canvas",t=document.createElement(a),this.c=M,_(t,"width",n=e[0].camera.area.width+"px"),_(t,"height",r=e[0].camera.area.height+"px")},m(n,r){B(n,t,r),e[6](t)},p(e,[a]){1&a&&n!==(n=e[0].camera.area.width+"px")&&_(t,"width",n),1&a&&r!==(r=e[0].camera.area.height+"px")&&_(t,"height",r)},i:M,o:M,d(n){n&&P(t),e[6](null)}}}function re(e,t,n){let r,a,{geo:o=w()}=t,{mode:i={name:"default",state:{}}}=t,s=function(e,t=M){let n;const r=[];function a(t){if(E(e,t)&&(e=t,n)){const t=!te.length;for(let t=0;t<r.length;t+=1){const n=r[t];n[1](),te.push(n,e)}if(t){for(let e=0;e<te.length;e+=2)te[e][0](te[e+1]);te.length=0}}}return{set:a,update:function(t){a(t(e))},subscribe:function(o,i=M){const s=[o,i];return r.push(s),1===r.length&&(n=t(a)||M),o(e),()=>{const e=r.indexOf(s);-1!==e&&r.splice(e,1),0===r.length&&(n(),n=null)}}}}(i);function l(e){return function t(){a=requestAnimationFrame(t),o.render(e)}(),()=>{cancelAnimationFrame(a)}}return j(()=>{o.render(r.getContext("2d"));const e=$(r);return s.subscribe(()=>{e.set(i.name,{elem:e,geo:o,...i.state})}),l(r.getContext("2d"))}),e.$set=e=>{"geo"in e&&n(0,o=e.geo),"mode"in e&&n(2,i=e.mode)},e.$$.update=()=>{4&e.$$.dirty&&s.set(i)},[o,r,i,a,s,l,function(e){A[e?"unshift":"push"](()=>{n(1,r=e)})}]}class ae extends F{constructor(e){super(),ee(this,{target:this.shadowRoot},re,ne,E,{geo:0,mode:2}),e&&(e.target&&B(e.target,this,e.anchor),e.props&&(this.$set(e.props),I()))}static get observedAttributes(){return["geo","mode"]}get geo(){return this.$$.ctx[0]}set geo(e){this.$set({geo:e}),I()}get mode(){return this.$$.ctx[2]}set mode(e){this.$set({mode:e}),I()}}function oe(e){let t,n,r;function a(t){e[2].call(null,t)}function o(t){e[3].call(null,t)}let i={};void 0!==e[0]&&(i.geo=e[0]),void 0!==e[1]&&(i.mode=e[1]);const s=new ae({props:i});return A.push(()=>K(s,"geo",a)),A.push(()=>K(s,"mode",o)),{c(){var e;(e=s.$$.fragment)&&e.c(),this.c=M},m(e,t){Q(s,e,t),r=!0},p(e,[r]){const a={};!t&&1&r&&(t=!0,a.geo=e[0],q(()=>t=!1)),!n&&2&r&&(n=!0,a.mode=e[1],q(()=>n=!1)),s.$set(a)},i(e){r||(V(s.$$.fragment,e),r=!0)},o(e){!function(e,t,n,r){if(e&&e.o){if(R.has(e))return;R.add(e),(void 0).c.push(()=>{R.delete(e),r&&(n&&e.d(1),r())}),e.o(t)}}(s.$$.fragment,e),r=!1},d(e){U(s,e)}}}function ie(e,t,n){b.register.shape("hexagon",[["moveTo",2.5,43.3],["lineTo",26.25,84.77],["lineTo",73.75,84.77],["lineTo",97.5,43.3],["lineTo",73.75,2.165],["lineTo",26.25,2.165],["closePath"]]),b.register.shape("boundary",[["rect",10,10,780,780]]),b.register.style("black",{fillStyle:"black",lineWidth:3,lineJoin:"round"}),b.register.style("thinBlackLines",{lineWidth:5,strokeStyle:"black",lineJoin:"round"}),b.register.subject("lone hex",{details:{shape:"hexagon",style:"black",trace:"lone hex"},transform:[1,0,0,1,100,100],visible:!0,renderer:"simple"}),b.register.subject("boundaries",{details:{shape:"boundary",style:"thinBlackLines",trace:"boundaries"},transform:[1,0,0,1,0,0],visible:!0,renderer:"simple"}),b.register.subject("base layer",{details:{subjects:["boundaries","lone hex"]},transform:[1,0,0,1,0,0],visible:!0,renderer:"nested"}),b.register.mode("tracing",{mousedown:(e,{geo:t})=>{console.log(t.handles.intersectPoint({x:e.offsetX,y:e.offsetY}))}},e=>e);let r=w();r.camera.extents={min:{x:0,y:0,zoom:null},max:{x:800,y:800,zoom:5}},r.scene=["base layer"];let a={name:"tracing",state:{}};return[r,a,function(e){r=e,n(0,r)},function(e){a=e,n(1,a)}]}customElements.define("geomancer-scene",ae);class se extends F{constructor(e){super(),ee(this,{target:this.shadowRoot},ie,oe,E,{}),e&&e.target&&B(e.target,this,e.anchor)}}return customElements.define("geomancer-example",se),e.Example=se,e.Geomancer=ae,e.default=w,e.elemental=$,e.geomancer=w,e.measure=i,e.style=m,e.tome=b,e.tracer=s,e.view=h,e}({});
//# sourceMappingURL=bundle.js.map
